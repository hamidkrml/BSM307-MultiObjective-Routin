services:
  # Development mode - with volume mounts for hot reload
  routing-dev:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: bsm307-routing-dev
    volumes:
      - .:/app
      - /app/.venv  # Exclude venv from mount
    environment:
      - PYTHONPATH=/app
      - MPLBACKEND=Agg  # Headless mode (no GUI)
      - EXPERIMENT_SEED=42
      - NUM_NODES=250
      - EDGE_PROB=0.4
    command: python demo.py
    stdin_open: true
    tty: true
    profiles:
      - dev

  # Production mode - optimized build
  routing-prod:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: bsm307-routing-prod
    environment:
      - PYTHONPATH=/app
      - MPLBACKEND=Agg
      - EXPERIMENT_SEED=42
      - NUM_NODES=250
      - EDGE_PROB=0.4
    command: python demo.py
    profiles:
      - prod

  # GUI mode - with X11 forwarding (requires XQuartz on Mac)
  routing-gui:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: bsm307-routing-gui
    volumes:
      - .:/app
      - /tmp/.X11-unix:/tmp/.X11-unix:rw
    environment:
      - PYTHONPATH=/app
      - DISPLAY=host.docker.internal:0
      - MPLBACKEND=TkAgg  # GUI backend
      - EXPERIMENT_SEED=42
      - NUM_NODES=250
      - EDGE_PROB=0.4
    network_mode: host
    command: python demo.py
    profiles:
      - gui

  # UI mode - Interactive matplotlib UI
  routing-ui:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: bsm307-routing-ui
    volumes:
      - .:/app
      - /tmp/.X11-unix:/tmp/.X11-unix:rw
    environment:
      - PYTHONPATH=/app
      - DISPLAY=host.docker.internal:0
      - MPLBACKEND=TkAgg  # GUI backend for interactive UI
      - EXPERIMENT_SEED=42
      - NUM_NODES=250
      - EDGE_PROB=0.4
    network_mode: host
    command: python run_ui.py
    profiles:
      - ui

  # Web mode - FastAPI web server
  routing-web:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: bsm307-routing-web
    volumes:
      - .:/app
    environment:
      - PYTHONPATH=/app
      - PORT=8000
      - HOST=0.0.0.0
      - EXPERIMENT_SEED=42
      - NUM_NODES=250
      - EDGE_PROB=0.4
    ports:
      - "8001:8000"  # Host port: 8001, Container port: 8000
    entrypoint: []  # Entrypoint'i devre dışı bırak
    command: python run_web.py  # Web server'ı başlat
    stdin_open: true
    tty: true
    profiles:
      - web

  # Experiment mode - Run experiments (quick test)
  routing-experiment-quick:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: bsm307-routing-experiment-quick
    volumes:
      - .:/app
      - ./experiments/results:/app/experiments/results  # Results mount
    environment:
      - PYTHONPATH=/app
      - MPLBACKEND=Agg  # Headless mode
      - EXPERIMENT_SEED=42
      - NUM_NODES=250
      - EDGE_PROB=0.4
    entrypoint: []  # Entrypoint'i devre dışı bırak
    command: python experiments/run_experiments.py --num-scenarios 2 --repetitions 1
    profiles:
      - experiment-quick

  # Experiment mode - Run full experiments (PDF requirements)
  routing-experiment-full:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: bsm307-routing-experiment-full
    volumes:
      - .:/app
      - ./experiments/results:/app/experiments/results  # Results mount
    environment:
      - PYTHONPATH=/app
      - MPLBACKEND=Agg  # Headless mode
      - EXPERIMENT_SEED=42
      - NUM_NODES=250
      - EDGE_PROB=0.4
    entrypoint: []  # Entrypoint'i devre dışı bırak
    command: python experiments/run_experiments.py --num-scenarios 20 --repetitions 5
    profiles:
      - experiment-full

  # Experiment mode - Interactive experiment runner (custom args)
  routing-experiment:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: bsm307-routing-experiment
    volumes:
      - .:/app
      - ./experiments/results:/app/experiments/results  # Results mount
    environment:
      - PYTHONPATH=/app
      - MPLBACKEND=Agg  # Headless mode
      - EXPERIMENT_SEED=42
      - NUM_NODES=250
      - EDGE_PROB=0.4
    entrypoint: []  # Entrypoint'i devre dışı bırak
    command: python experiments/run_experiments.py  # Default: full experiment
    stdin_open: true
    tty: true
    profiles:
      - experiment

